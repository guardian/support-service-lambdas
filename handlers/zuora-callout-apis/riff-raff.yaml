stacks:
  - support
regions:
  - eu-west-1
allowedStages:
  - CODE
  - PROD
deployments:
  # Upload JAR to S3 first (needed before CloudFormation can create the Lambda)
  zuora-auto-cancel-upload:
    type: aws-s3
    app: zuora-auto-cancel
    parameters:
      bucketSsmLookup: true
      prefixStack: true
      prefixApp: true
      prefixStage: true

  zuora-auto-cancel-cloudformation:
    type: cloud-formation
    app: zuora-auto-cancel
    parameters:
      templateStagePaths:
        CODE: zuora-auto-cancel-CODE.template.json
        PROD: zuora-auto-cancel-PROD.template.json
      cloudFormationStackByTags: false
      createStackIfAbsent: true
    dependencies:
      - zuora-auto-cancel-upload

  zuora-callout-apis:
    type: aws-lambda
    parameters:
      fileName: zuora-callout-apis.jar
      bucketSsmLookup: true
      prefixStack: false
      functionNames:
        - zuora-auto-cancel-
    dependencies:
      - zuora-auto-cancel-cloudformation

