# holiday-stop-api
All endpoints require...

- `x-api-key` header (generated by the `HolidayStopApiKey` in the CloudFormation)
- and either...
  - `x-identity-id` header which specifies the identityID of the user to request data for _(sent in the `manage-frontend` use-case)_
  - `x-salesforce-contact-id` header which specifies the Salesforce contact ID of the user to request data for _(sent in the CSR UI (in Salesforce) use-case)_

| Method | Endpoint | Description |
| --- | --- | --- | 
| GET | `/{STAGE}/potential/{SUBSCRIPTION_NAME}?startDate={yyyy-MM-dd}&endDate={yyyy-MM-dd}&estimateCredit={true`&#124;`false}` | returns a response containing dates for each issue impacted between the start and end parameters inclusively, for the subscription. Optionally the estimated credit can be calculated for each issue (which comes with the invoice date it will be appear on) |
| GET | `/{STAGE}/hsr/{SUBSCRIPTION_NAME}` | returns all holiday stops (past & present) for the specified subscription (user is verified as the 'bill to' contact of the subscription). Response includes an 'annualIssueLimit' and an 'issueSpecifics' array containing a series of objects each with calculated 'firstAvailableDate' and 'issueDayOfWeek'.|
| POST | `/{STAGE}/hsr` | creates a new all holiday stop, example body `{ "start": "2023-06-10", "end": "2024-06-14", "subscriptionName": "A-S00071783" }`|
| DELETE | `/{STAGE}/hsr/{SUBSCRIPTION_NAME} /{SF_ID}` | deletes the holiday stop request from SalesForce (with Id matching `{SF_ID}`) |


### Handling Multiple Environments
This lambda has a one-to-one relationship between AWS Stack/Stage and Salesforce Environment.
- SF DEV <-> AWS DEV Stack
- SF UAT <-> AWS CODE Stack
- SF PROD <-> AWS PROD Stack


The CSR UI (in Salesforce) is one consumer of this API and so each Salesforce environment is configured to speak the corresponding instance of the lambda.

`manage-frontend` is the main consumer and it supports 'test-users' and calls the correct instance of this lambda accordingly.

| Stage of `manage-frontend` | normal mode | test user mode |
| --- | --- | --- |
| DEV (local machine) | DEV Lambda* (SF Dev) | CODE Lambda (SF UAT) |
| CODE | DEV Lambda* (SF Dev) | CODE Lambda (SF UAT) |
| PROD | PROD Lambda (SF Dev) | CODE Lambda (SF UAT) |

\* Yes indeed there is a DEV Stack for the lambda, which is unusual and currently a bit fiddly to deploy via Riff-Raff (you need to 'Preview' the deploy then change the 'stage' parameter in the URL)

