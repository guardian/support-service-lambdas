# sf-move-subscriptions-api
API for moving subscriptions in ZUORA from SalesForce

API Gateway
with self doc (`GET`) and updating(moving subscriptions) (`POST`)

All endpoints require...

- `x-api-key` header (generated by the `sf-move-subscriptions-api-${stage}`)

API have a self doc endpoint at root `/` which will display example req body for (`POST`) method

endpoints:

- `self doc` method=GET, path=`/`
- `moving subscription` method=POST, path=`/subscription/move`, body=

```json
{
   "zuoraSubscriptionId": "Zuora Subscription Id",
   "sfAccountId": "SF Account Id",
   "sfFullContactId": "SF Full contact Id",
   "identityId": "id from guardian identity service, if not set in SF send blank value (empty string)"
}
```

# how to generate/update cfn.yml by AWS CDK

- go to /cdk
- start `npm run watch` it will transpile Typescript to JavaScript in real time
- run `npm run synth` it will generate/update `cfn.yml` file in module root directory

more details on cdk usage is in cdk/README.md

## About CDK and CloudFormation usage

`cfn.yml` file in module root directory is generated from `handlers/sf-move-subscriptions-api/cdk/lib/sf-move-subscriptions-stack.ts` file
and it should be treat as autogenerated code
it is not git-ignored for `riffraff` build integration which is using yml files now not AWS CDK cli
